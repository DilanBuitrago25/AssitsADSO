@model List<ClaseDatos.Asistencia>

@{
    ViewBag.Title = "Asistencias de la Ficha " + ViewBag.FichaId;
}

<h2>@ViewBag.Title</h2>

<table class="table">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Hora Inicio</th>
            <th>Hora Fin</th>
            <th>... (otras columnas relevantes)</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {

            var asistenciaidQr = @Html.DisplayFor(model => item.Id_asistencia);
            <div class="col-xxl-4 col-lg-6 asistencia-item">
                <div class="project-box">
                    @{
                        var fechaFinAsistencia = DateTime.Parse(item.Fecha_fin_asistencia + " " + item.Hora_fin_asistencia);
                    }

                    <span class="badge @(DateTime.Now > fechaFinAsistencia ? "badge-danger" : "badge-primary")">
                        @(DateTime.Now > fechaFinAsistencia ? "Finalizado" : "A Tiempo")
                    </span>
                    <h6>Asistencia @Html.DisplayFor(model => item.Fecha_inicio_asistencia)</h6>
                    <div class="media">
                        <div class="media-body">
                            <p>Ficha - @Html.DisplayFor(model => item.Ficha.Codigo_ficha)</p>
                        </div>

                        <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal-@item.Id_asistencia">Ver Qr</button>
                    </div>
                    <p>Competencia - @Html.DisplayFor(model => item.Competencia.Nombre_competencia).</p>
                    @Html.ActionLink("Ver Listado Asistencias", "Asistencia_Aprendices", "Asistencias", new { fichaId = item.Id_ficha, asistenciaId = item.Id_asistencia }, null)

                    <div class="row details">
                        <div class="col-6"><span>Asistieron </span></div>
                        <div class="col-6 font-primary">12 </div>
                        <div class="col-6"> <span>No Asistieron</span></div>
                        <div class="col-6 font-primary">5</div>
                        <div class="col-6"> <span>Justificaron Inasistencia</span></div>
                        <div class="col-6 font-primary">7</div>
                    </div>
                    <div class="customers"></div>
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade modal-bookmark" id="exampleModal-@item.Id_asistencia" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Codigo Qr de la Asistencia</h5>
                            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="form-bookmark needs-validation" id="bookmark-form" novalidate="">
                                <a href="@Url.Action("Edit", "Asistencias", new { id = item.Id_asistencia })">
                                    <img class="qr-image" src="@Url.Content("~/QRCodes/" + item.Id_asistencia + ".png")" alt="QR para editar asistencia" />
                                </a>
                                <input id="index_var" type="hidden" value="6">
                                <button class="btn btn-primary" type="button" data-bs-dismiss="modal">Cerrar</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        }
    </tbody>
</table>
